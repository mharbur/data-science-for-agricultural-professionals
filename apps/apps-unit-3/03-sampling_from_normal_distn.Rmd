---
title: "Sampling from a Normal Distribution"
output: 
  prettydoc::html_pretty:
    theme: default
runtime: shiny
---


```{r message=FALSE, include=FALSE}
library(tidyverse)

yield = read.csv("data/yield_df.csv")
```


Below we have a very powerful demonstration app which we will return to sever times in this lesson.  The top plot shows the population distribution -- that is, the counts for every individual observation in our soybean field.

The middle plot features a histogram that shows the distribution of our sample values.  The slider in the upper left controls the number of samples.  Slide it to the right to increase the number of samples.  As the number of samples increases, their distribution will become more normal in shape.  

The histogram in the middle plot is overlaid with two vertical reference lines.  The red line is $\sigma$, the population mean.  This line is fixed at about 80.1.  The blue line is $\bar{x}$, the sample mean.  The sample mean changes with the number of samples.  It never permanently converges on the population mean, but their distance generally decreases as the number of samples increases.


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(shiny)

ui = fluidPage(
  sidebarLayout(
    sidebarPanel(
      sliderInput("no_samples", "Select number of samples", min = 1, max = 100, step=1, value = 2)
    ),
    mainPanel(
      plotOutput("populationPlot", height="300px"),
      plotOutput("sampleDist", height="300px"),
      plotOutput("CLT", height="300px")
    )
  )
)

server = function(input, output){
  
  output$populationPlot = renderPlot({
    ggplot(yield, aes(x=yield_bu)) +
      geom_histogram(fill="white", color="black") +
      lims(x=c(55, 105)) +
      geom_text(aes(x=100, y=300), label=paste0("SD = ", round(sd(yield$yield_bu), 2)), size=8)
  })
  
  sampleData=reactive({
    set.seed(1995)
    sample_list = list()
    for(i in c(1:1000)){
      samples = mean(sample(yield$yield_bu, input$no_samples), na.rm = TRUE) %>%
        as.data.frame()
      sample_list[[i]] = samples
    }
    sample_list_df = do.call(rbind.data.frame, sample_list)
    names(sample_list_df) = "yield"
    sample_list_df
  })
  
  output$sampleDist = renderPlot({
    set.seed(1995)
    samples = sample(yield$yield_bu, input$no_samples, replace=TRUE) %>%
        as.data.frame()   
    names(samples) = "yield"
    pop_mean = mean(yield$yield_bu)
    sample_mean = mean(samples$yield)
    ggplot(samples, aes(x=yield)) +
      geom_histogram(fill="white", color="black") +
      geom_vline(xintercept = pop_mean, color = "red") +
      geom_vline(xintercept = sample_mean, color = "blue") +
      lims(x = c(55,105), y=c(0,14)) +
      geom_text(aes(x=100, y=7.5), label = paste0("\u03bc", " = ", round(pop_mean,1)), color="red", size=8) +
      geom_text(aes(x=100, y=6), label = paste0("\u03c3", " = ", round(sample_mean,1)), color="blue", size=8)
  })
  
  output$CLT = renderPlot({
    set.seed(2003)
    sample_list = list()
    for(i in c(1:1000)){
      samples = mean(sample(yield$yield_bu, input$no_samples,replace=TRUE), na.rm = TRUE) %>%
        as.data.frame()
      sample_list[[i]] = samples
    }
    sample_list_df = do.call(rbind.data.frame, sample_list)
    names(sample_list_df) = "yield"
    pop_mean = mean(yield$yield_bu)
    ggplot(sample_list_df, aes(x=yield)) +
      geom_histogram(fill="white", color="black") +
      geom_vline(xintercept = pop_mean, color = "red") +
      lims(x=c(55,105), y=c(0,600)) +
      geom_text(aes(x=100, y=300), label=paste0("SEM = ", round(sd(sample_list_df$yield), 2)), size=8)
      # lims(x=c(55, 105)) +
      # annotate(geom = "text", label = paste0("population mean = ", round(pop_mean,1)), x=Inf, y=Inf, vjust=0.5, color="red", size=8,  )
    
      # geom_text(aes(x=85, y=0.15), label = paste0("sample mean = ", round(sample_mean,1)), color="blue", size=8, hjust=0)
  })  
}

shinyApp(ui, server, options = list(height="1000px"))

```

The bottom plot is another normal distribution.  This dataset shows the distribution of sample means.  It was created by generating 1000 sample means, based on the number of samples selected with the slider.  If you select the number of samples to be 5, then the dataset consists is generated by taking five random samples and calculating their mean -- and repeating this process 1000 times.

There are two important things one should notice about this plot.  First, the sample means are normally distributed.  This illustrates a key concept that makes statistical tests possible -- and yet is given the most boring, confusing name imaginable: Central Limit Theorem.  Second, as the number of samples selected increases, the distribution of sample means narrows in width, meaning the sample means are distributed more closely around the population mean.  

